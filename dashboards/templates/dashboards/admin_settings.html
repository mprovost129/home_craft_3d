{# templates/dashboards/admin_settings.html #}
{% extends "base.html" %}
{% block title %}Admin Settings · Home Craft 3D{% endblock %}

{% block content %}
<style>
  input[type="text"],
  input[type="number"],
  input[type="email"],
  input[type="password"],
  input[type="url"],
  input[type="date"],
  input[type="time"],
  select,
  textarea {
    background-color: #ffffff !important;
    color: #333333 !important;
  }
</style>

<div class="container-fluid">
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div>
      <h1 class="h4 mb-1">Admin Settings</h1>
      <div class="text-secondary small">
        Manage store-wide settings without the Django admin.
        {% if site_config_updated_at %}
          <span class="ms-2">Last saved: {{ site_config_updated_at|date:"M j, Y g:i A" }}</span>
        {% endif %}
      </div>
    </div>
    <div class="d-flex flex-wrap gap-2">
      <a class="btn btn-outline-secondary" href="{% url 'dashboards:admin' %}">
        <i class="bi bi-arrow-left me-1"></i>Back to Admin
      </a>
      <a class="btn btn-outline-secondary" href="{% url 'admin:index' %}">
        <i class="bi bi-gear me-1"></i>Django Admin
      </a>
    </div>
  </div>

  {# ✅ SHOW DJANGO MESSAGES (this was missing) #}
  {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} mb-2" role="alert">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="card">
    <div class="card-body">
      <form method="post" novalidate>
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="alert alert-danger">{{ form.non_field_errors }}</div>
        {% endif %}

        <div class="row g-3">
          <div class="col-12 col-lg-4">
            <label class="form-label">Marketplace sales percent</label>
            {{ form.marketplace_sales_percent }}
            {% if form.marketplace_sales_percent.errors %}
              <div class="text-danger small mt-1">{{ form.marketplace_sales_percent.errors }}</div>
            {% endif %}
          </div>

          <div class="col-12 col-lg-4">
            <label class="form-label">Platform fee (cents)</label>
            {{ form.platform_fee_cents }}
            {% if form.platform_fee_cents.errors %}
              <div class="text-danger small mt-1">{{ form.platform_fee_cents.errors }}</div>
            {% endif %}
          </div>

          <div class="col-12 col-lg-4">
            <label class="form-label">Default currency</label>
            {{ form.default_currency }}
            {% if form.default_currency.errors %}
              <div class="text-danger small mt-1">{{ form.default_currency.errors }}</div>
            {% endif %}
          </div>

          <div class="col-12">
            <label class="form-label">Allowed shipping countries</label>
            {{ form.allowed_shipping_countries_csv }}
            <div class="form-text">{{ form.allowed_shipping_countries_csv.help_text }}</div>
            {% if form.allowed_shipping_countries_csv.errors %}
              <div class="text-danger small mt-1">{{ form.allowed_shipping_countries_csv.errors }}</div>
            {% endif %}
          </div>
        </div>

        <div class="col-12 mt-3">
          <label class="form-label">Plausible shared dashboard URL</label>
          {{ form.plausible_shared_url }}
          {% if form.plausible_shared_url.help_text %}
            <div class="form-text">{{ form.plausible_shared_url.help_text }}</div>
          {% else %}
            <div class="form-text">
              Paste your Plausible shared link (ex: https://plausible.io/share/homecraft3d.com?auth=...).
            </div>
          {% endif %}
          {% if form.plausible_shared_url.errors %}
            <div class="text-danger small mt-1">{{ form.plausible_shared_url.errors }}</div>
          {% endif %}
        </div>

        <hr class="my-4">

        <h2 class="h6 mb-3">Home Page</h2>

        <div class="row g-3">
          <div class="col-12 col-lg-6">
            <label class="form-label">Hero title</label>
            {{ form.home_hero_title }}
            {% if form.home_hero_title.errors %}
              <div class="text-danger small mt-1">{{ form.home_hero_title.errors }}</div>
            {% endif %}
            {% if form.home_hero_title.help_text %}
              <div class="form-text">{{ form.home_hero_title.help_text }}</div>
            {% endif %}
          </div>

          <div class="col-12">
            <label class="form-label">Hero subtitle</label>
            {{ form.home_hero_subtitle }}
            {% if form.home_hero_subtitle.errors %}
              <div class="text-danger small mt-1">{{ form.home_hero_subtitle.errors }}</div>
            {% endif %}
            {% if form.home_hero_subtitle.help_text %}
              <div class="form-text">{{ form.home_hero_subtitle.help_text }}</div>
            {% endif %}
          </div>
        </div>

        <hr class="my-4">

        <h5 class="mb-3">Promo Banner (sitewide above navbar)</h5>

        <div class="mb-3 form-check">
          {{ form.promo_banner_enabled }}
          <label class="form-check-label" for="{{ form.promo_banner_enabled.id_for_label }}">
            Enable promo banner
          </label>
        </div>

        <div class="mb-3">
          <label class="form-label" for="{{ form.promo_banner_text.id_for_label }}">
            Promo banner text
          </label>
          {{ form.promo_banner_text }}
          <div class="form-text">
            Example: Sellers pay 0% marketplace fees for their first 30 days!
          </div>
          {% if form.promo_banner_text.errors %}
            <div class="text-danger small mt-1">{{ form.promo_banner_text.errors }}</div>
          {% endif %}
        </div>

        <hr class="my-4">

        <h5 class="mb-3">Home Page Banner (home page only)</h5>

        <div class="mb-3 form-check">
          {{ form.home_banner_enabled }}
          <label class="form-check-label" for="{{ form.home_banner_enabled.id_for_label }}">
            Enable home page banner
          </label>
        </div>

        <div class="mb-3">
          <label class="form-label" for="{{ form.home_banner_text.id_for_label }}">
            Home page banner text
          </label>
          {{ form.home_banner_text }}
          <div class="form-text">
            Example: <em>First 30 days FREE!</em>
          </div>
          {% if form.home_banner_text.errors %}
            <div class="text-danger small mt-1">{{ form.home_banner_text.errors }}</div>
          {% endif %}
        </div>

        <hr class="my-4">

        <h2 class="h6 mb-3">Theme</h2>

        <div class="row g-3">
          <div class="col-12 col-lg-4">
            <label class="form-label">Default mode</label>
            {{ form.theme_default_mode }}
          </div>

          <div class="col-12 col-lg-4">
            <label class="form-label">Primary (buttons / CTAs)</label>
            {{ form.theme_primary }}
          </div>

          <div class="col-12 col-lg-4">
            <label class="form-label">Accent</label>
            {{ form.theme_accent }}
          </div>

          <div class="col-12 col-lg-4">
            <label class="form-label">Success</label>
            {{ form.theme_success }}
          </div>

          <div class="col-12 col-lg-4">
            <label class="form-label">Danger</label>
            {{ form.theme_danger }}
          </div>
        </div>

        <div class="row g-3 mt-1">
          <div class="col-12 col-lg-6">
            <div class="border rounded p-3">
              <div class="fw-semibold mb-2">Light mode surfaces</div>
              <div class="row g-2">
                <div class="col-12 col-md-6"><label class="form-label small">BG</label>{{ form.theme_light_bg }}</div>
                <div class="col-12 col-md-6"><label class="form-label small">Surface</label>{{ form.theme_light_surface }}</div>
                <div class="col-12 col-md-6"><label class="form-label small">Text</label>{{ form.theme_light_text }}</div>
                <div class="col-12 col-md-6"><label class="form-label small">Muted</label>{{ form.theme_light_text_muted }}</div>
                <div class="col-12 col-md-6"><label class="form-label small">Border</label>{{ form.theme_light_border }}</div>
              </div>
            </div>
          </div>

          <div class="col-12 col-lg-6">
            <div class="border rounded p-3">
              <div class="fw-semibold mb-2">Dark mode surfaces</div>
              <div class="row g-2">
                <div class="col-12 col-md-6"><label class="form-label small">BG</label>{{ form.theme_dark_bg }}</div>
                <div class="col-12 col-md-6"><label class="form-label small">Surface</label>{{ form.theme_dark_surface }}</div>
                <div class="col-12 col-md-6"><label class="form-label small">Text</label>{{ form.theme_dark_text }}</div>
                <div class="col-12 col-md-6"><label class="form-label small">Muted</label>{{ form.theme_dark_text_muted }}</div>
                <div class="col-12 col-md-6"><label class="form-label small">Border</label>{{ form.theme_dark_border }}</div>
              </div>
            </div>
          </div>
        </div>

        <hr class="my-4">

        <h2 class="h6 mb-3">Social Links</h2>
        <div class="row g-3">
          <div class="col-12 col-md-6">
            <label class="form-label">Facebook</label>
            {{ form.facebook_url }}
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Instagram</label>
            {{ form.instagram_url }}
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">TikTok</label>
            {{ form.tiktok_url }}
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">YouTube</label>
            {{ form.youtube_url }}
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">X (Twitter)</label>
            {{ form.x_url }}
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">LinkedIn</label>
            {{ form.linkedin_url }}
          </div>
        </div>

        <div class="mt-4 d-flex gap-2">
          <button class="btn btn-primary" type="submit">
            <i class="bi bi-save me-1"></i>Save Settings
          </button>
          <a class="btn btn-outline-secondary" href="{% url 'dashboards:admin' %}">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
