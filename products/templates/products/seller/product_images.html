{% extends "base.html" %}
{% block title %}Seller · Images · {{ product.title }} · Home Craft 3D{% endblock %}

{% block content %}
<div class="container-fluid" style="max-width: 980px;">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h1 class="h4 mb-1">Images</h1>
      <div class="text-secondary small">{{ product.title }}</div>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-dark" href="{% url 'products:seller_edit' product.pk %}">
        <i class="bi bi-pencil me-1"></i>Edit Listing
      </a>
      <a class="btn btn-outline-dark" href="{% url 'products:seller_list' %}">
        <i class="bi bi-arrow-left me-1"></i>Back
      </a>
    </div>
  </div>

  <!-- Upload Section -->
  <div class="card mb-4 border-0 shadow-sm">
    <div class="card-header bg-light border-bottom">
      <h2 class="h5 mb-0">
        <i class="bi bi-image me-2"></i>Upload New Image
      </h2>
    </div>
    <div class="card-body">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row g-3">
          <div class="col-12">
            <label class="form-label fw-semibold">Image File <span class="text-danger">*</span></label>
            {{ form.image }}
            {% if form.image.errors %}<div class="text-danger small mt-1">{{ form.image.errors }}</div>{% endif %}
            <div class="form-text">JPG, PNG, or WebP (up to 10MB recommended)</div>
          </div>

          <div class="col-12">
            <label class="form-label fw-semibold">Alt Text (Accessibility)</label>
            {{ form.alt_text }}
            {% if form.alt_text.errors %}<div class="text-danger small mt-1">{{ form.alt_text.errors }}</div>{% endif %}
            <div class="form-text">Describe what the image shows. Helps with SEO and accessibility.</div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label fw-semibold">Display Order</label>
            {{ form.sort_order }}
            {% if form.sort_order.errors %}<div class="text-danger small mt-1">{{ form.sort_order.errors }}</div>{% endif %}
            <div class="form-text">0 = first image, 1 = second, etc.</div>
          </div>

          <div class="col-12 col-md-6">
            <div class="form-check mt-4">
              {{ form.is_primary }}
              <label class="form-check-label fw-semibold" for="{{ form.is_primary.id_for_label }}">
                <i class="bi bi-star-fill text-warning me-1"></i>Set as primary image
              </label>
            </div>
            <div class="form-text">This will be the thumbnail shown in listings.</div>
          </div>
        </div>

        <div class="mt-4 pt-3 border-top">
          <button class="btn btn-dark btn-lg" type="submit">
            <i class="bi bi-cloud-upload me-2"></i>Upload Image
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Current Images Section -->
  <div class="card border-0 shadow-sm">
    <div class="card-header bg-light border-bottom">
      <h2 class="h5 mb-0">
        <i class="bi bi-images me-2"></i>Current Images
      </h2>
    </div>
    <div class="card-body">

      <div class="row g-3">
        {% for img in images %}
          <div class="col-12 col-md-6">
            <div class="card h-100 border-0 shadow-sm overflow-hidden">
              {% if img.is_primary %}
                <div class="position-absolute top-0 end-0 m-2">
                  <span class="badge bg-warning text-dark">
                    <i class="bi bi-star-fill me-1"></i>Primary
                  </span>
                </div>
              {% endif %}
              
              <img src="{{ img.image.url }}" alt="{{ img.alt_text|default:product.title }}" class="card-img-top" style="height: 200px; object-fit: cover;">
              
              <div class="card-body d-flex flex-column">
                {% if img.alt_text %}
                  <p class="card-text text-secondary small mb-2">{{ img.alt_text }}</p>
                {% else %}
                  <p class="card-text text-secondary small text-muted mb-2"><em>No alt text</em></p>
                {% endif %}
                
                <div class="mt-auto">
                  <div class="text-secondary small mb-3">
                    <i class="bi bi-arrow-down me-1"></i>Order: <strong>{{ img.sort_order }}</strong>
                  </div>
                  
                  <form method="post" action="{% url 'products:seller_image_delete' product.pk img.pk %}" class="d-inline">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-outline-danger w-100" type="submit">
                      <i class="bi bi-trash me-1"></i>Delete Image
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="col-12">
            <div class="alert alert-light border border-secondary text-secondary py-4 text-center">
              <i class="bi bi-image" style="font-size: 2.5rem; opacity: 0.5;"></i>
              <p class="mt-3 mb-0">No images uploaded yet.</p>
              <small class="text-muted">Upload images above to get started.</small>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  {% if messages %}
    <div class="mt-3">
      {% for message in messages %}
        <div class="alert alert-info mb-2">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %}
