{# core/templates/core/home.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Home Craft 3D ¬∑ 3D Prints & Digital Files Marketplace{% endblock %}
{% block meta_title %}Home Craft 3D ¬∑ 3D Prints & Digital Files{% endblock %}
{% block og_title %}{{ product.title }} ¬∑ Home Craft 3D{% endblock %}
{% block og_description %}{{ product.short_description }}{% endblock %}
{% block meta_description %}Sometimes creativity needs to be shared...{% endblock %}

{% block content %}
  
  {% include "includes/home_banner.html" %}
  <br>
  
  {% if ad_banner %}
  <div class="container mb-4">
    <div class="row justify-content-center">
      <div class="col-12 col-md-10">
        <div class="alert alert-warning p-0 border-0 rounded-3 overflow-hidden position-relative">
          {% if ad_banner.link_url %}
            <a href="{{ ad_banner.link_url }}" target="_blank" rel="noopener" class="d-block text-decoration-none">
              <img src="{{ ad_banner.image.url }}" alt="{{ ad_banner.title }}" class="img-fluid w-100" style="max-height:180px;object-fit:cover;">
            </a>
          {% else %}
            <img src="{{ ad_banner.image.url }}" alt="{{ ad_banner.title }}" class="img-fluid w-100" style="max-height:180px;object-fit:cover;">
          {% endif %}
          {% if ad_banner.title %}
            <div class="position-absolute bottom-0 start-0 w-100 bg-dark bg-opacity-50 text-white p-2 small text-center">{{ ad_banner.title }}</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  {% endif %}
<!-- Hero Section -->
<div class="bg-light border-bottom mb-5">
  <div class="container py-5">
    <div class="row align-items-center g-4">
      <div class="col-lg-6">
        <h2 class="display-5 fw-bold mb-3">
          <strong> {{ site_config.home_hero_title|default:"Welcome to Home Craft 3D" }} </strong>
        </h2>
        <p class="lead text-secondary mb-4">
          <strong> {{ site_config.home_hero_subtitle|default:"Sometimes creativity needs to be shared..."|linebreaksbr|safe }} </strong>
        </p>

        <div class="d-flex flex-wrap gap-2">
          <a class="btn btn-dark btn-lg" href="{% url 'products:list' %}">
            <i class="bi bi-search me-2"></i>Browse All Products
          </a>
          <a class="btn btn-outline-dark btn-lg" href="{% url 'catalog:category_list' %}">
            <i class="bi bi-grid me-2"></i>Explore Categories
          </a>
        </div>
      </div>

      <div class="col-lg-6 text-center">
        <div class="bg-secondary-subtle p-4 rounded-3 h-100 d-flex align-items-center justify-content-center">
          <img
            src="{% static 'images/homecraft3d_facebook.png' %}"
            alt="3D printer in action printing a dragon"
            class="img-fluid rounded-3 hero-image">
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Category Quick Links -->
<div class="container mb-5">
  <div class="row g-3">
    <div class="col-md-4">
      <div class="card h-100 text-center p-4 border-0 bg-light">
        <h5 class="card-title mb-2">3D Models</h5>
        <p class="text-secondary small mb-3">Ready-to-print designs</p>
        <a href="{% url 'products:models' %}" class="btn btn-sm btn-outline-dark">Browse Models</a>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card h-100 text-center p-4 border-0 bg-light">
        <h5 class="card-title mb-2">Digital Files</h5>
        <p class="text-secondary small mb-3">Instant downloads</p>
        <a href="{% url 'products:files' %}" class="btn btn-sm btn-outline-dark">Browse Files</a>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card h-100 text-center p-4 border-0 bg-light">
        <h5 class="card-title mb-2">Top Sellers</h5>
        <p class="text-secondary small mb-3">Trusted creators</p>
        <a href="{% url 'products:top_sellers' %}" class="btn btn-sm btn-outline-dark">View Sellers</a>
      </div>
    </div>
  </div>
</div>

<div class="container">
  {% if trending %}
    <div class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="h3 mb-1">üî• Trending Now</h2>
          <p class="text-secondary">Hot products everyone's talking about</p>
        </div>
        <a href="{% url 'products:list' %}?sort=trending" class="btn btn-sm btn-outline-secondary">View all</a>
      </div>
      <div class="row g-3">
        {% for p in trending %}
          <div class="col-12 col-sm-6 col-lg-3">
            {% include "products/_product_card.html" with p=p show_add_to_cart=True show_category=False image_height="200px" %}
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {% if new_items %}
    <div class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="h3 mb-1">‚ú® Just Added</h2>
          <p class="text-secondary">Latest designs uploaded</p>
        </div>
        <a href="{% url 'products:list' %}?sort=new" class="btn btn-sm btn-outline-secondary">View all</a>
      </div>
      <div class="row g-3">
        {% for p in new_items %}
          <div class="col-12 col-sm-6 col-lg-3">
            {% include "products/_product_card.html" with p=p show_add_to_cart=True show_category=False image_height="200px" %}
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {% if recently_purchased_list %}
    <div class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="h3 mb-1">‚≠ê Customer Favorites</h2>
          <p class="text-secondary">Popular purchases in the last 30 days</p>
        </div>
        <a href="{% url 'products:list' %}" class="btn btn-sm btn-outline-secondary">View all</a>
      </div>
      <div class="row g-3">
        {% for p in recently_purchased_list %}
          <div class="col-12 col-sm-6 col-lg-3">
            {% include "products/_product_card.html" with p=p show_add_to_cart=True show_category=False image_height="200px" %}
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {% if most_downloaded_list %}
    <div class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="h3 mb-1">üì• Most Downloaded</h2>
          <p class="text-secondary">Top digital files everyone's getting</p>
        </div>
        <a href="{% url 'products:files' %}?sort=trending" class="btn btn-sm btn-outline-secondary">View all</a>
      </div>
      <div class="row g-3">
        {% for p in most_downloaded_list %}
          <div class="col-12 col-sm-6 col-lg-3">
            {% include "products/_product_card.html" with p=p show_add_to_cart=True show_category=False image_height="200px" %}
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {% if featured %}
    <div class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="h3 mb-1">üéØ Featured Picks</h2>
          <p class="text-secondary">Curated selections from our store</p>
        </div>
        <a href="{% url 'products:list' %}" class="btn btn-sm btn-outline-secondary">View all</a>
      </div>
      <div class="row g-3">
        {% for p in featured %}
          <div class="col-12 col-sm-6 col-lg-3">
            {% include "products/_product_card.html" with p=p show_add_to_cart=True show_category=False image_height="200px" %}
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <br>

  {% if product.filament_recommendations.all %}
  <section class="mt-4">
    <h4>Recommended Filament</h4>
  
    <ul class="list-unstyled">
      {% for rec in product.filament_recommendations.all %}
        {% if rec.is_active %}
          <li class="mb-2">
            <strong>{{ rec.get_material_display }}</strong>
            {% if rec.brand %} ‚Äî {{ rec.brand }}{% endif %}
            {% if rec.notes %}<div class="text-muted small">{{ rec.notes }}</div>{% endif %}
            <div>
              <a href="{{ rec.url }}" target="_blank" rel="noopener noreferrer">
                View filament ‚Üó
              </a>
            </div>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  </section>
  {% endif %}

  <br>

  <div class="bg-dark text-white rounded-3 p-5 mb-5 text-center">
    <h2 class="mb-3">Ready to start creating or selling?</h2>
    <p class="lead text-light mb-4">Join our community of creators. Upload your designs, connect with customers, and grow your business.</p>
    {% if not user.is_authenticated %}
      <a href="{% url 'accounts:register' %}" class="btn btn-light btn-lg">Get Started Today</a>
    {% else %}
      <a href="{% url 'payments:connect_status' %}" class="btn btn-light btn-lg">Become a Seller</a>
    {% endif %}
  </div>
</div>
{% endblock %}
