{% extends "base.html" %}
{% block title %}Home Â· Home Craft 3D{% endblock %}

{% block content %}
  <div style="max-width:1200px; margin:0 auto;">
    <div style="background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:22px;">
      <h1 style="margin-top:0;">Home Craft 3D</h1>
      <p style="color:#6b7280; margin-top:6px;">
        Buy and sell high-quality 3D printed models and 3D print files.
      </p>

      <div style="display:flex; gap:10px; margin-top:14px; flex-wrap:wrap;">
        <a class="hc3-btn" href="{% url 'products:models' %}">Browse Models</a>
        <a class="hc3-btn" href="{% url 'products:files' %}">Browse Files</a>
        <a class="hc3-btn" style="background:#fff; color:#111827;" href="{% url 'catalog:category_list' %}">Browse Categories</a>

        {% if not user.is_authenticated %}
          <a class="hc3-btn" style="background:#fff; color:#111827;" href="{% url 'accounts:register' %}">Register</a>
          <a class="hc3-btn" style="background:#fff; color:#111827;" href="{% url 'accounts:login' %}">Login</a>
        {% endif %}
      </div>
    </div>

    <div style="display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; margin-top: 16px;">

      <!-- Featured -->
      <div style="background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:16px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
          <strong>Featured</strong>
          <span style="color:#6b7280; font-size:13px;">Top picks</span>
        </div>

        <div style="display:grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap:12px; margin-top: 12px;">
          {% for p in featured %}
            <div style="border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; background:#fff;">
              <a href="{{ p.get_absolute_url }}" style="text-decoration:none; color:inherit;">
                <div style="aspect-ratio: 1 / 1; background:#f3f4f6; display:flex; align-items:center; justify-content:center;">
                  {% if p.primary_image %}
                    <img src="{{ p.primary_image.image.url }}" alt="{{ p.title }}" style="width:100%; height:100%; object-fit:cover;">
                  {% else %}
                    <span style="color:#9ca3af; font-size:12px;">No image</span>
                  {% endif %}
                </div>
              </a>

              <div style="padding:10px;">
                <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
                  <div style="display:flex; align-items:center; gap:6px; flex-wrap:wrap;">
                    {% if p.trending_badge %}
                      <span style="font-size:12px; background:#f59e0b; color:#111827; padding:2px 8px; border-radius:999px;">ðŸ”¥ Trending</span>
                    {% endif %}
                    <span style="font-size:12px; color:#6b7280;">{{ p.get_kind_display }}</span>
                  </div>
                  <span style="font-weight:600;">{{ p.display_price }}</span>
                </div>

                <div style="margin-top:6px; display:flex; align-items:center; justify-content:space-between; gap:8px;">
                  <a href="{{ p.get_absolute_url }}" style="text-decoration:none; color:inherit;">
                    <div style="font-weight:600; font-size:13px; line-height:1.2;">
                      {{ p.title|truncatechars:38 }}
                    </div>
                  </a>

                  <div style="font-size:12px; color:#6b7280; white-space:nowrap;">
                    {% if p.review_count and p.review_count > 0 %}
                      â˜… {{ p.avg_rating|floatformat:1 }}/5 ({{ p.review_count }})
                    {% else %}
                      No reviews
                    {% endif %}
                  </div>
                </div>

                <div style="margin-top:6px; color:#6b7280; font-size:12px;">
                  by {{ p.seller.username }}
                </div>

                <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
                  {% if p.can_buy %}
                    <form method="post" action="{% url 'cart:add' %}" style="margin:0;">
                      {% csrf_token %}
                      <input type="hidden" name="product_id" value="{{ p.id }}">
                      <input type="hidden" name="quantity" value="1">
                      <button class="hc3-btn" type="submit" style="padding:8px 10px; font-size:12px;">
                        Add to cart
                      </button>
                    </form>
                  {% else %}
                    <button class="hc3-btn" type="button" disabled style="padding:8px 10px; font-size:12px; opacity:.55; cursor:not-allowed;">
                      Add to cart
                    </button>
                    <span style="color:#b45309; font-size:12px;">Seller not ready</span>
                  {% endif %}
                </div>
              </div>
            </div>
          {% empty %}
            <div style="grid-column: 1 / -1; color:#6b7280; font-size:13px;">No featured products yet.</div>
          {% endfor %}
        </div>
      </div>

      <!-- New -->
      <div style="background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:16px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
          <strong>New</strong>
          <span style="color:#6b7280; font-size:13px;">Just added</span>
        </div>

        <div style="display:grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap:12px; margin-top: 12px;">
          {% for p in new_items %}
            <div style="border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; background:#fff;">
              <a href="{{ p.get_absolute_url }}" style="text-decoration:none; color:inherit;">
                <div style="aspect-ratio: 1 / 1; background:#f3f4f6; display:flex; align-items:center; justify-content:center;">
                  {% if p.primary_image %}
                    <img src="{{ p.primary_image.image.url }}" alt="{{ p.title }}" style="width:100%; height:100%; object-fit:cover;">
                  {% else %}
                    <span style="color:#9ca3af; font-size:12px;">No image</span>
                  {% endif %}
                </div>
              </a>

              <div style="padding:10px;">
                <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
                  <div style="display:flex; align-items:center; gap:6px; flex-wrap:wrap;">
                    {% if p.trending_badge %}
                      <span style="font-size:12px; background:#f59e0b; color:#111827; padding:2px 8px; border-radius:999px;">ðŸ”¥ Trending</span>
                    {% endif %}
                    <span style="font-size:12px; color:#6b7280;">{{ p.get_kind_display }}</span>
                  </div>
                  <span style="font-weight:600;">{{ p.display_price }}</span>
                </div>

                <div style="margin-top:6px; display:flex; align-items:center; justify-content:space-between; gap:8px;">
                  <a href="{{ p.get_absolute_url }}" style="text-decoration:none; color:inherit;">
                    <div style="font-weight:600; font-size:13px; line-height:1.2;">
                      {{ p.title|truncatechars:38 }}
                    </div>
                  </a>

                  <div style="font-size:12px; color:#6b7280; white-space:nowrap;">
                    {% if p.review_count and p.review_count > 0 %}
                      â˜… {{ p.avg_rating|floatformat:1 }}/5 ({{ p.review_count }})
                    {% else %}
                      No reviews
                    {% endif %}
                  </div>
                </div>

                <div style="margin-top:6px; color:#6b7280; font-size:12px;">
                  by {{ p.seller.username }}
                </div>

                <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
                  {% if p.can_buy %}
                    <form method="post" action="{% url 'cart:add' %}" style="margin:0;">
                      {% csrf_token %}
                      <input type="hidden" name="product_id" value="{{ p.id }}">
                      <input type="hidden" name="quantity" value="1">
                      <button class="hc3-btn" type="submit" style="padding:8px 10px; font-size:12px;">
                        Add to cart
                      </button>
                    </form>
                  {% else %}
                    <button class="hc3-btn" type="button" disabled style="padding:8px 10px; font-size:12px; opacity:.55; cursor:not-allowed;">
                      Add to cart
                    </button>
                    <span style="color:#b45309; font-size:12px;">Seller not ready</span>
                  {% endif %}
                </div>
              </div>
            </div>
          {% empty %}
            <div style="grid-column: 1 / -1; color:#6b7280; font-size:13px;">No products yet.</div>
          {% endfor %}
        </div>
      </div>

      <!-- Trending -->
      <div style="background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:16px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
          <strong>Trending</strong>
          <span style="color:#6b7280; font-size:13px;">Popular now</span>
        </div>

        <div style="display:grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap:12px; margin-top: 12px;">
          {% for p in trending %}
            <div style="border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; background:#fff;">
              <a href="{{ p.get_absolute_url }}" style="text-decoration:none; color:inherit;">
                <div style="aspect-ratio: 1 / 1; background:#f3f4f6; display:flex; align-items:center; justify-content:center;">
                  {% if p.primary_image %}
                    <img src="{{ p.primary_image.image.url }}" alt="{{ p.title }}" style="width:100%; height:100%; object-fit:cover;">
                  {% else %}
                    <span style="color:#9ca3af; font-size:12px;">No image</span>
                  {% endif %}
                </div>
              </a>

              <div style="padding:10px;">
                <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
                  <div style="display:flex; align-items:center; gap:6px; flex-wrap:wrap;">
                    {% if p.trending_badge %}
                      <span style="font-size:12px; background:#f59e0b; color:#111827; padding:2px 8px; border-radius:999px;">ðŸ”¥ Trending</span>
                    {% endif %}
                    <span style="font-size:12px; color:#6b7280;">{{ p.get_kind_display }}</span>
                  </div>
                  <span style="font-weight:600;">{{ p.display_price }}</span>
                </div>

                <div style="margin-top:6px; display:flex; align-items:center; justify-content:space-between; gap:8px;">
                  <a href="{{ p.get_absolute_url }}" style="text-decoration:none; color:inherit;">
                    <div style="font-weight:600; font-size:13px; line-height:1.2;">
                      {{ p.title|truncatechars:38 }}
                    </div>
                  </a>

                  <div style="font-size:12px; color:#6b7280; white-space:nowrap;">
                    {% if p.review_count and p.review_count > 0 %}
                      â˜… {{ p.avg_rating|floatformat:1 }}/5 ({{ p.review_count }})
                    {% else %}
                      No reviews
                    {% endif %}
                  </div>
                </div>

                <div style="margin-top:6px; color:#6b7280; font-size:12px;">
                  by {{ p.seller.username }}
                </div>

                <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
                  {% if p.can_buy %}
                    <form method="post" action="{% url 'cart:add' %}" style="margin:0;">
                      {% csrf_token %}
                      <input type="hidden" name="product_id" value="{{ p.id }}">
                      <input type="hidden" name="quantity" value="1">
                      <button class="hc3-btn" type="submit" style="padding:8px 10px; font-size:12px;">
                        Add to cart
                      </button>
                    </form>
                  {% else %}
                    <button class="hc3-btn" type="button" disabled style="padding:8px 10px; font-size:12px; opacity:.55; cursor:not-allowed;">
                      Add to cart
                    </button>
                    <span style="color:#b45309; font-size:12px;">Seller not ready</span>
                  {% endif %}
                </div>
              </div>
            </div>
          {% empty %}
            <div style="grid-column: 1 / -1; color:#6b7280; font-size:13px;">No trending products yet.</div>
          {% endfor %}
        </div>
      </div>

      <!-- Misc -->
      <div style="background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:16px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
          <strong>Misc</strong>
          <span style="color:#6b7280; font-size:13px;">More to explore</span>
        </div>

        <div style="display:grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap:12px; margin-top: 12px;">
          {% for p in misc %}
            <div style="border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; background:#fff;">
              <a href="{{ p.get_absolute_url }}" style="text-decoration:none; color:inherit;">
                <div style="aspect-ratio: 1 / 1; background:#f3f4f6; display:flex; align-items:center; justify-content:center;">
                  {% if p.primary_image %}
                    <img src="{{ p.primary_image.image.url }}" alt="{{ p.title }}" style="width:100%; height:100%; object-fit:cover;">
                  {% else %}
                    <span style="color:#9ca3af; font-size:12px;">No image</span>
                  {% endif %}
                </div>
              </a>

              <div style="padding:10px;">
                <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
                  <div style="display:flex; align-items:center; gap:6px; flex-wrap:wrap;">
                    {% if p.trending_badge %}
                      <span style="font-size:12px; background:#f59e0b; color:#111827; padding:2px 8px; border-radius:999px;">ðŸ”¥ Trending</span>
                    {% endif %}
                    <span style="font-size:12px; color:#6b7280;">{{ p.get_kind_display }}</span>
                  </div>
                  <span style="font-weight:600;">{{ p.display_price }}</span>
                </div>

                <div style="margin-top:6px; display:flex; align-items:center; justify-content:space-between; gap:8px;">
                  <a href="{{ p.get_absolute_url }}" style="text-decoration:none; color:inherit;">
                    <div style="font-weight:600; font-size:13px; line-height:1.2;">
                      {{ p.title|truncatechars:38 }}
                    </div>
                  </a>

                  <div style="font-size:12px; color:#6b7280; white-space:nowrap;">
                    {% if p.review_count and p.review_count > 0 %}
                      â˜… {{ p.avg_rating|floatformat:1 }}/5 ({{ p.review_count }})
                    {% else %}
                      No reviews
                    {% endif %}
                  </div>
                </div>

                <div style="margin-top:6px; color:#6b7280; font-size:12px;">
                  by {{ p.seller.username }}
                </div>

                <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
                  {% if p.can_buy %}
                    <form method="post" action="{% url 'cart:add' %}" style="margin:0;">
                      {% csrf_token %}
                      <input type="hidden" name="product_id" value="{{ p.id }}">
                      <input type="hidden" name="quantity" value="1">
                      <button class="hc3-btn" type="submit" style="padding:8px 10px; font-size:12px;">
                        Add to cart
                      </button>
                    </form>
                  {% else %}
                    <button class="hc3-btn" type="button" disabled style="padding:8px 10px; font-size:12px; opacity:.55; cursor:not-allowed;">
                      Add to cart
                    </button>
                    <span style="color:#b45309; font-size:12px;">Seller not ready</span>
                  {% endif %}
                </div>
              </div>
            </div>
          {% empty %}
            <div style="grid-column: 1 / -1; color:#6b7280; font-size:13px;">Nothing else yet.</div>
          {% endfor %}
        </div>
      </div>

    </div>
  </div>
{% endblock %}
